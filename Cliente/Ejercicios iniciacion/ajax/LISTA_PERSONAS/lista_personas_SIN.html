<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Ejercicio Listado Personas. AJAX</title>
    <style type="text/css"></style>

    <script type="text/javascript">
      window.onload = () => {
        peticionAJAX("post","http://localhost:3000/Cliente/Ejercicios%20iniciacion/ajax/LISTA_PERSONAS/servidor.php",{ servicio: "listar" },(datos) =>
         {pintarPersonas(datos);
          }
        );

        document.querySelector("#btBorrar").onclick = function () {
          let borrar = {
            servicio: "borrar",
            ID: document.getElementById("id").value,
          };

          peticionAJAX("delete","http://localhost:3000/Cliente/Ejercicios%20iniciacion/ajax/LISTA_PERSONAS/servidor.php",borrar,(datos) => {
              pintarPersonas(datos);
            }
          );
        };

        document.querySelector("#btAnade").onclick = function () {
          let ingresar = {
            servicio: "insertar",
            DNI: document.querySelector("#dni").value,
            NOMBRE: document.querySelector("#nombre").value,
            APELLIDOS: document.querySelector("#apellidos").value,
          };
          peticionAJAX("delete","http://localhost:3000/Cliente/Ejercicios%20iniciacion/ajax/LISTA_PERSONAS/servidor.php",ingresar,(datos) => {
              pintarPersonas(datos);
            }
          );
        };
      };

      function pintarPersonas(datos) {
        let cuerpo = document.querySelector("#filas_tabla");
        cuerpo.innerHTML = "";
        for (persona of datos) {
          let fila = document.createElement("tr");
          for (i in persona) {
            let columna = document.createElement("td");
            columna.innerHTML = persona[i];
            fila.append(columna);
            cuerpo.append(fila);
          }
        }
      }

      const peticionAJAX = (metodo, url, servicio, callback) => {
        const peticion = new XMLHttpRequest();
        peticion.open(metodo, url, true);
        peticion.setRequestHeader("Content-type","application/x-www-form-urlencoded");
        peticion.send(JSON.stringify(servicio));
        peticion.onreadystatechange = () => {
          if (peticion.readyState == 4 && peticion.status == 200) {
            callback(JSON.parse(peticion.responseText));
          }
        };
      };
    </script>
  </head>
  <body>
    <h1>Registro de Usuarios</h1>

    <form>
      <label for="dni">DNI:</label>
      <input type="text" id="dni" name="dni" value="27473339T" />
      <span id="infoDNI"> </span>
      <br />
      <label for="nombre">NOMBRE:</label>
      <input type="text" id="nombre" name="nombre" value="Marco Elio" />
      <br />
      <label for="apellidos">APELLIDOS:</label>
      <input type="text" id="apellidos" name="apellidos" value="García Gomariz"/>
      <br />
      <br />

      <table id="tabla_personas" border="1">
        <tr>
          <th>ID</th>
          <th>DNI</th>
          <th>NOMBRE</th>
          <th>APELLIDOS</th>
        </tr>

        <tbody id="filas_tabla"></tbody>
      </table>

      <br />
      <br />
      <input type="button" value="AÑADIR" id="btAnade" />
      <br /><br />
      <input type="button" value="BORRAR" id="btBorrar" />
      <input type="text" id="id" name="id" value="" size="5" placeholder="ID a borrar" />
    </form>
  </body>
</html>
